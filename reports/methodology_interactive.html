<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Data Feature Pyramid Methodology</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #dbeafe;
            --secondary: #475569;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f1f5f9;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #1e40af);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        h1 { margin: 0; font-size: 2.5rem; letter-spacing: -1px; }
        .subtitle { font-size: 1.1rem; opacity: 0.9; margin-top: 10px; max-width: 600px; margin-left: auto; margin-right: auto; }
        
        .content-area {
            display: flex;
            padding: 40px;
            gap: 40px;
        }
        
        @media (max-width: 768px) {
            .content-area { flex-direction: column; }
        }
        
        /* Pyramid Visualization */
        .pyramid-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 500px;
        }
        
        .pyramid-level {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .pyramid-level:hover, .pyramid-level.active {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
        }

        /* Shape the pyramid using clip-path implies standard rectangles, let's use width scaling */
        .level-4 { width: 30%; height: 80px; background-color: var(--danger); border-radius: 8px 8px 0 0; }
        .level-3 { width: 50%; height: 90px; background-color: var(--warning); }
        .level-2 { width: 70%; height: 100px; background-color: var(--success); }
        .level-1 { width: 90%; height: 110px; background-color: var(--primary); border-radius: 0 0 8px 8px; }
        
        .level-label {
            text-align: center;
        }
        
        .level-label small {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: normal;
            text-transform: none;
        }

        /* Detail Panel */
        .detail-panel {
            flex: 1;
            background-color: var(--light);
            border-radius: 8px;
            padding: 30px;
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .detail-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .detail-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        .concept-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            background-color: var(--secondary);
            color: white;
        }
        
        .example-box {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }
        
        .example-title {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        h3 { margin-top: 0; }

        .hidden { display: none; }
        
        /* Guide Steps */
        .guide-section {
            background-color: var(--dark);
            color: white;
            padding: 40px;
        }
        
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .step-card {
            background-color: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }
        
        .step-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--warning);
            margin-bottom: 10px;
            display: block;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>The Data Feature Pyramid</h1>
        <div class="subtitle">A strategic framework for tackling complex datasets: From raw variables to latent synthesis.</div>
    </header>

    <div class="content-area">
        <!-- Visualization Side -->
        <div class="pyramid-container">
            <div class="pyramid-level level-4" onclick="showLevel(4)">
                <div class="level-label">
                    Layer 4: Latent Synthesis
                    <small>Model-Based Features</small>
                </div>
            </div>
            <div class="pyramid-level level-3" onclick="showLevel(3)">
                <div class="level-label">
                    Layer 3: Interactions
                    <small>Context & Amplifiers</small>
                </div>
            </div>
            <div class="pyramid-level level-2" onclick="showLevel(2)">
                <div class="level-label">
                    Layer 2: Behavioral
                    <small>Ratios & Trajectories</small>
                </div>
            </div>
            <div class="pyramid-level level-1 active" onclick="showLevel(1)">
                <div class="level-label">
                    Layer 1: Foundations
                    <small>Domain Knowledge "Must-Haves"</small>
                </div>
            </div>
        </div>

        <!-- Detail Side -->
        <div id="detail-1" class="detail-panel">
            <div class="detail-header">
                <span class="detail-icon">üèóÔ∏è</span>
                <div class="detail-title">Layer 1: Foundations</div>
            </div>
            <span class="concept-tag" style="background-color: var(--primary);">Variable Selection</span>
            <p><strong>Goal: Survival.</strong> Select the non-negotiable variables based on domain expertise before looking at correlations.</p>
            <p>This is your starting point. Don't throw everything into the model. Filter down from thousands of raw columns to the 20-30 that fundamentally describe the entity.</p>
            
            <div class="example-box">
                <div class="example-title">In Our Project:</div>
                <p>We selected <strong>Age, Sex, Chronic Conditions, and Prior Cost</strong>. Why? Because medical literature dictates that these are the primary drivers of health risk. No model can succeed without them.</p>
            </div>
        </div>

        <div id="detail-2" class="detail-panel hidden">
            <div class="detail-header">
                <span class="detail-icon">üìà</span>
                <div class="detail-title">Layer 2: Behavioral Signals</div>
            </div>
            <span class="concept-tag" style="background-color: var(--success);">Feature Engineering</span>
            <p><strong>Goal: Structure & Change.</strong> Raw totals (e.g., Total Spend) are often misleading. Look for ratios ("How they spend") and trajectories ("How fast it's changing").</p>
            <p>This layer turns static nouns into dynamic verbs.</p>

            <div class="example-box">
                <div class="example-title">In Our Project:</div>
                <p>Instead of just counting "ER Visits", we created <strong>RATIO_ER_OFFICE</strong>. A patient with 5 ER visits and 0 Office visits is far riskier than one with 5 ER visits and 20 Office visits.</p>
            </div>
        </div>

        <div id="detail-3" class="detail-panel hidden">
            <div class="detail-header">
                <span class="detail-icon">‚úñÔ∏è</span>
                <div class="detail-title">Layer 3: Interactions</div>
            </div>
            <span class="concept-tag" style="background-color: var(--warning);">Contextual Amplification</span>
            <p><strong>Goal: "Bad + Bad = Worst".</strong> Identify amplifiers‚Äîconditions that make existing risks non-linearly worse.</p>
            <p>Use multiplication for continuous variables and Clustering (Segmentation) to find groups where rules apply differently.</p>

            <div class="example-box">
                <div class="example-title">In Our Project:</div>
                <p>We built <strong>INTERACT_CHRONIC_MENTAL</strong>. Physical illness costs more when mental health is poor. We also used <strong>K-Means Clustering</strong> to find "Care Phenotypes" (e.g., Crisis Users vs. Routine Users).</p>
            </div>
        </div>

        <div id="detail-4" class="detail-panel hidden">
            <div class="detail-header">
                <span class="detail-icon">üîÆ</span>
                <div class="detail-title">Layer 4: Latent Synthesis</div>
            </div>
            <span class="concept-tag" style="background-color: var(--danger);">Advanced Modeling</span>
            <p><strong>Goal: Compression.</strong> When raw rules aren't enough, use a model to generate a feature.</p>
            <p>Define a "Proxy Target" (e.g., a specific bad event), train an auxiliary model to predict it, and use that probability score as a powerful input for your main model.</p>

            <div class="example-box">
                <div class="example-title">In Our Project:</div>
                <p>The <strong>Two-Stage Latent Risk Model</strong>. We trained a model to predict "Hidden Risers" and fed that probability (<code>PROB_LATENT_RISK</code>) into our final model. It became the single strongest predictor.</p>
            </div>
        </div>
    </div>

    <div class="guide-section">
        <h3>How to Apply This to New Data: The "Hypothesis-First" Approach</h3>
        <div class="steps-grid">
            <div class="step-card">
                <span class="step-number">01</span>
                <h4>Hypothesis List</h4>
                <p>Don't code yet. Write down 5 assumptions about "Why" the target happens. (e.g., "Poor people delay care until it's an emergency").</p>
            </div>
            <div class="step-card">
                <span class="step-number">02</span>
                <h4>Targeted Deep Dive</h4>
                <p>Select the "Target=1" group and the "Target=0" group. Calculate the mean difference for every variable. Focus only on the top 10 differences.</p>
            </div>
            <div class="step-card">
                <span class="step-number">03</span>
                <h4>Ratio Construction</h4>
                <p>If you see Variable A and Variable B, always check if A/B is more predictive. Ratios normalize bias.</p>
            </div>
            <div class="step-card">
                <span class="step-number">04</span>
                <h4>Model as Feature</h4>
                <p>If you run out of ideas, let a model find the pattern. Train an unsupervised model (PCA/Clustering) or a proxy supervised model.</p>
            </div>
        </div>
    </div>
</div>

<script>
    function showLevel(level) {
        // Reset all
        for(let i=1; i<=4; i++) {
            document.querySelector(`.level-${i}`).classList.remove('active');
            document.getElementById(`detail-${i}`).classList.add('hidden');
        }
        
        // Activate selected
        document.querySelector(`.level-${level}`).classList.add('active');
        document.getElementById(`detail-${level}`).classList.remove('hidden');
        
        // Update border color of detail panel to match level
        const colors = ['#2563eb', '#10b981', '#f59e0b', '#ef4444'];
        const details = document.querySelectorAll('.detail-panel');
        details.forEach(El => El.style.borderLeftColor = colors[level-1]);
    }
</script>

</body>
</html>
